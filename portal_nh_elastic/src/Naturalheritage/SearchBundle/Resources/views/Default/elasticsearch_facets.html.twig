<html>
<head>
	<link href="{{asset('assets/vendor/bootstrap-4.3.1-dist/css/bootstrap.min.css')}}" rel="stylesheet" />
	<link href="{{asset('assets/vendor/bootstrap-4.3.1-dist/css/bootstrap-grid.min.css')}}" rel="stylesheet" />
    <link href="{{asset('assets/vendor/bootstrap-datepicker-1.6.4-dist/css/bootstrap-datepicker.min.css')}}" rel="stylesheet" />
	<link href="{{asset('assets/vendor/select2/dist/css/select2.css')}}" rel="stylesheet" />
	<link href="{{asset('assets/vendor/openlayers/v4.x.x-dist/ol.css')}}" rel="stylesheet" />
    <link href="{{asset('assets/vendor/css_facets/theme.css')}}" rel="stylesheet" />    
	<link href="{{asset('assets/styles/naturalheritage.css')}}" rel="stylesheet" />   
</head>
<body>
<script src="{{asset('assets/vendor/jquery/dist/jquery.min.js')}}"></script>
<script src="{{asset('assets/vendor/jquery-facets/jquery.deserialize.js')}}"></script>
<script src="{{asset('assets/vendor/jquery-facets/jquery.facets.js')}}"></script>
<script src="{{asset('assets/vendor/select2/dist/js/select2.full.js')}}"></script>
<script src="{{asset('assets/vendor/bootstrap-4.3.1-dist/js/bootstrap.bundle.js')}}"></script>
<script src="{{asset('assets/vendor/bootstrap-datepicker-1.6.4-dist/js/bootstrap-datepicker.min.js')}}"></script>
<script src="{{asset('assets/vendor/openlayers/v4.x.x-dist/ol.js')}}"></script>
<script src="{{asset('assets/js/logic_facets.js')}}"></script>


<div  id="wrap">
<form id="test_facets" class="filter-sec">
<div class="container-fluid">
<div class="row" >
<div class="col-md-4 col-sm-4">
Free text: <select id="elastic_search_freetext" class="select2 memoryforfacet" style='width:300px'></select>
</div>
{% include 'NaturalheritageSearchBundle:Default:elasticsearch_facets_detailed_search.html.twig' with {'details' : details} %}</br>
<input type="button" class="search_dem" id="search_dem" name="search_dem" value="search"></input><br/>
<div class="col-md12 col-sm-12">
{% include 'NaturalheritageSearchBundle:Default:search_map_bootstrap.html.twig' with {'map' : map} %}</br>

</div>
<div name="div_search" id="div_search" class="col-md3 col-sm-4">
<div class="lefta-sec">
<div class="lefta-cont">

<input type="hidden" id="base_url" value="{{url('naturalheritage_search_homepage')}}"></input>
<input type="hidden" id="facet_criteria"></input>
<input type="hidden" id="facet_criteria_generic"></input>
<input type="hidden" id="facet_criteria_annex"></input>




<div id="placeholder_facets" name="placeholder_facets"></div>

</div>
</div>
</div>
<div name="div_results" id="div_results" class="col-md9 col-sm-8">

<div id="searchCont"  class="right-sec">
  
  
</div>
</div>
</div>
</form>
</div>

<script language="javascript">
var route;
var full_screen=true;
route=$("#base_url").val();


var search_fct=function(term)
{
    
  
        var url=route.concat("es_wrapper");
        var result_url=route.concat("result_facets");
		var facet_url=route.concat("detail_facets");

        
         var criterias={};
         criterias["term"]=term;
		 criterias["expanded"]=false;
         if($("#facet_criteria").val().length>0)
         {

                criterias["extra_params"]=$("#facet_criteria").val();
				criterias["expanded"]=true;
         }
		 if($("#facet_criteria_generic").val().length>0)
         {

                criterias["extra_params_generic"]=$("#facet_criteria_generic").val();
				criterias["expanded"]=true;
         }
		 if($("#facet_criteria_annex").val().length>0)
         {
                criterias["extra_params2"]=$("#facet_criteria_annex").val();
				criterias["expanded"]=true;
         }
         if($("#tmpN").val().length>0 && $("#tmpW").val().length>0 && $("#tmpE").val().length>0 && $("#tmpS").val().length>0 )
         {
            criterias["coordinates"]=$("#tmpW").val()+";"+$("#tmpE").val()+";"+ $("#tmpS").val()+";"+$("#tmpN").val();
         }
         var dataTmp=criterias;
         if(Object.keys(dataTmp).length>0)
         {
             $.ajax(
                      {
                        url: detect_https(url),
                        data: dataTmp,
                        dataType : "json",
                        success: function( data ) 
                                {      
							      console.log(dataTmp);
                                  $.ajax(
                                            {
                                            url: detect_https(result_url),
                                            dataType: "html",
                                            success: function (data) {												
                                                $("#searchCont").html(data);
                                                $("#facet_criteria").val("");
												$("#facet_criteria_generic").val("");
												$("#facet_criteria2").val("");
                                                },
                                            }
                                     );
                                 $.ajax(
                                            {
                                            url: detect_https(facet_url),
                                            dataType: "html",
                                            success: function (data) {
                                                $("#placeholder_facets").html(data);
                                                },
                                            }
                                     );
                                },
                        
                      }
                    
                );
    
    }
 }


$(document).ready(
    function()
    {
   		$('#elastic_search_freetext').select2({
				//width: "300px",
				tags: true,
				multiple: false,
				  ajax: {
				    url: detect_https(route.concat("autocompletefulltext")),
				    data: function (params) {
				      var query = {
					q: params.term
				      }				      
					
				      return query;
				    },
					processResults: function(data) {
					       return {results: data};
					}
				  }
				});
       
       $(".search_dem").click(
        function()
        {
             var term=$("#elastic_search_freetext").val();
            search_fct(term);
        }
       )
	   

    }
);

</script>
{% include 'NaturalheritageSearchBundle:Default:nav.html.twig' %}</br>
</body>
</html>
